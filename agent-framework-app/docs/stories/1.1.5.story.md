# Story 1.1.5: External Service Configuration (Azure/OpenAI)

## Status: Draft

## Story
As a platform engineer, I want external LLM service credentials provisioned and securely injected, so that generation APIs function reliably in all environments.

## Acceptance Criteria
1. Azure OpenAI (or OpenAI) resource creation steps documented (portal & CLI reference).
2. Keys & endpoint retrieved from Azure portal Keys and Endpoint blade (two-key rotation practice noted).
3. Environment variables defined in `.env.example` (e.g., `AZURE_OPENAI_API_KEY`, `AZURE_OPENAI_ENDPOINT`, `AZURE_OPENAI_DEPLOYMENT_NAME`, `OPENAI_API_VERSION`).
4. Local `.env` loading verified; application can read variables at runtime (simple health endpoint or startup log).
5. Secret storage guidance documented (recommend Azure Key Vault for cloud deployments; no plaintext keys committed).
6. Key rotation procedure documented (swap KEY1/KEY2 with zero downtime).
7. Security note: prefer Microsoft Entra ID / managed identity for production; API key usage flagged as interim.
8. A minimal script or backend health endpoint validates the model credentials (dry-run or simple prompt).

## Dev Notes
- Document Azure OpenAI resource creation and credential retrieval steps.
- Add environment variables to `.env.example` and verify local loading.
- Document secret storage and key rotation procedures.
- Prefer managed identity for production deployments.
- Implement health endpoint or script to validate credentials.

## Tasks / Subtasks
- [ ] Document Azure/OpenAI resource creation (portal & CLI).
- [ ] Retrieve and record keys & endpoint; note two-key rotation.
- [ ] Add required environment variables to `.env.example`.
- [ ] Verify `.env` loading and runtime access.
- [ ] Document secret storage guidance (Azure Key Vault).
- [ ] Document key rotation procedure.
- [ ] Add security note for managed identity.
- [ ] Implement health endpoint/script for credential validation.

## Project Structure Notes
- Update documentation in `docs/architecture/3-tech-stack.md` and `docs/architecture/5-api-specification-openapi-30.md` as needed.

## Testing
- Backend: pytest for health endpoint/script.
- Manual: Validate credential loading and rotation.

## QA Results

## File List

## Dev Agent Record
- Agent Model Used:
- Debug Log References:
- Completion Notes List:
- Change Log:
